<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preços de Combustíveis - Guarulhos</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --accent: #0ea5e9;
            --accent-dark: #0284c7;
            --accent-light: #e0f2fe;
            --border: #e2e8f0;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gasolina: #ef4444;
            --etanol: #22c55e;
            --diesel: #3b82f6;
            --gnv: #a855f7;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }

        .dark {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --accent: #38bdf8;
            --accent-dark: #0ea5e9;
            --accent-light: #0c4a6e;
            --border: #334155;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -2px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -4px rgba(0, 0, 0, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .background-pattern {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 20% 80%, var(--accent-light) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(168, 85, 247, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(34, 197, 94, 0.05) 0%, transparent 40%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeInDown 0.6s ease-out;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .logo i {
            font-size: 2.5rem;
            color: var(--accent);
        }

        h1 {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent), #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .location {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-top: 8px;
        }

        .location i {
            color: var(--danger);
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            animation: fadeInDown 0.6s ease-out 0.1s both;
        }

        .tab-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
        }

        .tab-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            border-color: transparent;
            color: white;
        }

        .tab-btn.active i {
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .status-bar {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            animation: fadeInUp 0.6s ease-out 0.1s both;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: var(--bg-card);
            border-radius: 12px;
            box-shadow: var(--shadow);
            font-size: 0.9rem;
        }

        .status-item i {
            color: var(--accent);
        }

        .status-item.live {
            border: 1px solid var(--success);
        }

        .status-item.live i {
            color: var(--success);
            animation: pulse 2s infinite;
        }

        .status-item.outdated {
            border: 1px solid #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }

        .status-item.outdated i {
            color: #f59e0b;
            animation: pulse 2s infinite;
        }

        .status-item.outdated span {
            color: #d97706;
        }

        .dark .status-item.outdated {
            background: rgba(245, 158, 11, 0.15);
        }

        .dark .status-item.outdated i {
            color: #fbbf24;
        }

        .dark .status-item.outdated span {
            color: #fbbf24;
        }

        .status-item.error {
            border: 1px solid var(--danger);
            background: rgba(239, 68, 68, 0.1);
        }

        .status-item.error i {
            color: var(--danger);
        }

        .status-item.error span {
            color: var(--danger);
        }

        .status-item.reference-week {
            background: linear-gradient(135deg, var(--accent-light), rgba(168, 85, 247, 0.15));
            border: 1px solid var(--accent);
        }

        .status-item.reference-week i {
            color: var(--accent);
        }

        .status-item.reference-week strong {
            color: var(--accent-dark);
        }

        .dark .status-item.reference-week strong {
            color: var(--accent);
        }

        .fuel-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(220px, 320px));
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .fuel-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 24px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: fadeInUp 0.6s ease-out both;
            position: relative;
            overflow: hidden;
        }

        .fuel-card:nth-child(1) { animation-delay: 0.2s; }
        .fuel-card:nth-child(2) { animation-delay: 0.3s; }
        .fuel-card:nth-child(3) { animation-delay: 0.4s; }
        .fuel-card:nth-child(4) { animation-delay: 0.5s; }

        .fuel-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .fuel-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .fuel-card.gasolina::before { background: var(--gasolina); }
        .fuel-card.etanol::before { background: var(--etanol); }
        .fuel-card.diesel::before { background: var(--diesel); }
        .fuel-card.gnv::before { background: var(--gnv); }

        .fuel-icon {
            width: 50px;
            height: 50px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 16px;
        }

        .gasolina .fuel-icon {
            background: rgba(239, 68, 68, 0.15);
            color: var(--gasolina);
        }

        .etanol .fuel-icon {
            background: rgba(34, 197, 94, 0.15);
            color: var(--etanol);
        }

        .diesel .fuel-icon {
            background: rgba(59, 130, 246, 0.15);
            color: var(--diesel);
        }

        .gnv .fuel-icon {
            background: rgba(168, 85, 247, 0.15);
            color: var(--gnv);
        }

        .fuel-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .fuel-price {
            font-family: 'Space Mono', monospace;
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .fuel-price .currency {
            font-size: 1.2rem;
            color: var(--text-secondary);
        }

        .fuel-unit {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .fuel-card.loading .fuel-price,
        .fuel-card.loading .fuel-unit {
            background: linear-gradient(90deg, var(--border) 25%, var(--bg-secondary) 50%, var(--border) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 4px;
            color: transparent;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .update-section {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeInUp 0.6s ease-out 0.6s both;
        }

        .update-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 14px 28px;
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: white;
            border: none;
            border-radius: 14px;
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 14px rgba(14, 165, 233, 0.4);
        }

        .update-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(14, 165, 233, 0.5);
        }

        .update-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .update-btn.loading i {
            animation: spin 1s linear infinite;
        }

        .info-section {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            animation: fadeInUp 0.6s ease-out 0.7s both;
        }

        .info-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .info-title i {
            color: var(--accent);
        }

        .info-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.8;
        }

        .info-text a {
            color: var(--accent);
            text-decoration: none;
        }

        .info-text a:hover {
            text-decoration: underline;
        }

        .data-period {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: var(--accent-light);
            color: var(--accent-dark);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
            margin-top: 8px;
        }

        .dark .data-period {
            background: rgba(56, 189, 248, 0.2);
            color: var(--accent);
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 10px;
        }

        .error-message.show {
            display: flex;
        }

        .warning-message {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid #f59e0b;
            color: #d97706;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: none;
            align-items: flex-start;
            gap: 10px;
            text-align: left;
            line-height: 1.5;
        }

        .warning-message.show {
            display: flex;
        }

        .warning-message i {
            margin-top: 3px;
            flex-shrink: 0;
        }

        .dark .warning-message {
            background: rgba(245, 158, 11, 0.15);
            color: #fbbf24;
            border-color: #fbbf24;
        }

        .data-period.outdated {
            background: rgba(245, 158, 11, 0.2);
            color: #d97706;
            border: 1px solid #f59e0b;
        }

        .dark .data-period.outdated {
            background: rgba(245, 158, 11, 0.25);
            color: #fbbf24;
            border-color: #fbbf24;
        }

        .next-update {
            font-family: 'Space Mono', monospace;
            font-weight: 600;
            color: var(--accent);
        }

        /* WhatsApp Section */
        .whatsapp-section {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            margin-top: 20px;
            animation: fadeInUp 0.6s ease-out 0.75s both;
        }

        .whatsapp-section .info-title {
            color: #25D366;
        }

        .whatsapp-section .info-title i {
            color: #25D366;
        }

        .whatsapp-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 14px 28px;
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
            border: none;
            border-radius: 14px;
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 14px rgba(37, 211, 102, 0.4);
            margin-top: 16px;
        }

        .whatsapp-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.5);
        }

        .whatsapp-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .download-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-top: 12px;
            padding: 8px 16px;
            background: var(--accent-light);
            color: var(--accent-dark);
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .download-link:hover {
            background: var(--accent);
            color: white;
            text-decoration: none;
        }

        .dark .download-link {
            background: rgba(56, 189, 248, 0.2);
            color: var(--accent);
        }

        .dark .download-link:hover {
            background: var(--accent);
            color: white;
        }

        /* Prime Report Section */
        .prime-section {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            margin-top: 20px;
            animation: fadeInUp 0.6s ease-out 0.72s both;
        }

        .prime-section .info-title {
            color: #dc2626;
        }

        .prime-section .info-title i {
            color: #dc2626;
        }

        .prime-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 14px 28px;
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            border: none;
            border-radius: 14px;
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 14px rgba(220, 38, 38, 0.4);
            margin-top: 16px;
            text-decoration: none;
        }

        .prime-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.5);
            color: white;
            text-decoration: none;
        }

        .prime-update-info {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 16px;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .prime-update-info i {
            color: var(--text-muted);
        }

        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: var(--text-muted);
            font-size: 0.85rem;
            animation: fadeInUp 0.6s ease-out 0.8s both;
        }

        footer a {
            color: var(--accent);
            text-decoration: none;
        }

        /* Kilometragem Tab Styles */
        .km-container {
            animation: fadeInUp 0.6s ease-out;
        }

        .km-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }

        .km-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .km-title i {
            font-size: 2rem;
            color: var(--accent);
        }

        .km-title h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .km-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .km-update-info {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: var(--bg-card);
            border-radius: 12px;
            box-shadow: var(--shadow);
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .km-update-info i {
            color: var(--accent);
        }

        .km-table-container {
            background: var(--bg-card);
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .km-table-wrapper {
            overflow-x: auto;
        }

        .km-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .km-table th,
        .km-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .km-table th {
            background: linear-gradient(135deg, var(--accent-light), rgba(168, 85, 247, 0.1));
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
            position: sticky;
            top: 0;
        }

        .dark .km-table th {
            background: linear-gradient(135deg, rgba(56, 189, 248, 0.2), rgba(168, 85, 247, 0.15));
        }

        .km-table tbody tr:hover {
            background: var(--accent-light);
        }

        .dark .km-table tbody tr:hover {
            background: rgba(56, 189, 248, 0.1);
        }

        .km-table tbody tr.urgent {
            background: rgba(239, 68, 68, 0.15);
        }

        .km-table tbody tr.urgent:hover {
            background: rgba(239, 68, 68, 0.25);
        }

        .km-table .placa-cell {
            font-family: 'Space Mono', monospace;
            font-weight: 700;
            color: var(--text-primary);
        }

        .km-table .km-cell {
            font-family: 'Space Mono', monospace;
            font-weight: 600;
            color: var(--accent-dark);
        }

        .dark .km-table .km-cell {
            color: var(--accent);
        }

        .km-table .revision-input {
            width: 110px;
            padding: 6px 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-family: 'DM Sans', sans-serif;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }

        .km-table .revision-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
        }

        .km-table .revision-input.filled {
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--success);
        }

        .km-table .revision-input::-webkit-calendar-picker-indicator {
            filter: invert(0.5);
            cursor: pointer;
        }

        .dark .km-table .revision-input::-webkit-calendar-picker-indicator {
            filter: invert(0.8);
        }

        .km-next-revision {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .km-next-revision.urgent {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }

        .km-next-revision.warning {
            background: rgba(245, 158, 11, 0.15);
            color: #d97706;
        }

        .km-next-revision.ok {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
        }

        .km-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            padding: 16px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .km-legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .km-legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .km-legend-color.urgent {
            background: rgba(239, 68, 68, 0.3);
            border: 2px solid var(--danger);
        }

        .km-legend-color.warning {
            background: rgba(245, 158, 11, 0.3);
            border: 2px solid #f59e0b;
        }

        .km-empty-state {
            padding: 60px 20px;
            text-align: center;
            color: var(--text-muted);
        }

        .km-empty-state i {
            font-size: 4rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .km-empty-state p {
            font-size: 1.1rem;
        }

        /* Password Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 32px;
            max-width: 400px;
            width: 90%;
            box-shadow: var(--shadow-lg);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.show .modal-content {
            transform: scale(1);
        }

        .modal-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 20px;
        }

        .modal-title i {
            color: var(--accent);
        }

        .modal-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            margin-bottom: 16px;
            transition: all 0.2s ease;
        }

        .modal-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .modal-input.error {
            border-color: var(--danger);
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        .modal-error {
            color: var(--danger);
            font-size: 0.9rem;
            margin-bottom: 16px;
            display: none;
        }

        .modal-error.show {
            display: block;
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 12px 24px;
            border-radius: 10px;
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .modal-btn.cancel {
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .modal-btn.cancel:hover {
            background: var(--border);
        }

        .modal-btn.confirm {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: white;
        }

        .modal-btn.confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 14px rgba(14, 165, 233, 0.4);
        }

        @media (max-width: 600px) {
            .container {
                padding: 16px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .fuel-grid {
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }

            .fuel-card {
                padding: 16px;
            }

            .fuel-icon {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }

            .fuel-price {
                font-size: 1.5rem;
            }

            .status-bar {
                flex-direction: column;
                align-items: center;
            }

            .tab-nav {
                flex-direction: column;
            }

            .tab-btn {
                width: 100%;
                justify-content: center;
            }

            .km-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .km-actions {
                width: 100%;
            }

            .km-actions .update-btn {
                width: 100%;
                justify-content: center;
            }

            .km-table th,
            .km-table td {
                padding: 10px 8px;
                font-size: 0.8rem;
            }

            .km-table .revision-input {
                width: 90px;
                padding: 4px 6px;
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="background-pattern"></div>

    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-gas-pump"></i>
                <h1>Preços de Combustíveis</h1>
            </div>
            <div class="location">
                <i class="fas fa-map-marker-alt"></i>
                <span>Guarulhos, SP</span>
            </div>
        </header>

        <!-- Tab Navigation -->
        <div class="tab-nav">
            <button class="tab-btn active" data-tab="combustiveis" onclick="switchTab('combustiveis')">
                <i class="fas fa-gas-pump"></i>
                Combustíveis
            </button>
            <button class="tab-btn" data-tab="kilometragem" onclick="switchTab('kilometragem')">
                <i class="fas fa-tachometer-alt"></i>
                Kilometragem
            </button>
        </div>

        <!-- Combustíveis Tab -->
        <div class="tab-content active" id="tab-combustiveis">
            <div class="status-bar">
                <div class="status-item reference-week" id="referenceWeek" style="display: none;">
                    <i class="far fa-calendar-alt"></i>
                    <span>Semana: <strong id="referenceWeekText">--</strong></span>
                </div>
                <div class="status-item" id="lastUpdate">
                    <i class="far fa-clock"></i>
                    <span>Última consulta: <strong id="lastUpdateTime">--</strong></span>
                </div>
                <div class="status-item" id="nextUpdateItem">
                    <i class="fas fa-sync-alt"></i>
                    <span>Próxima: <strong class="next-update" id="nextUpdateTime">07:00</strong></span>
                </div>
                <div class="status-item live" id="liveStatus" style="display: none;">
                    <i class="fas fa-circle" id="liveStatusIcon"></i>
                    <span id="liveStatusText">Dados atualizados</span>
                </div>
            </div>

            <div class="error-message" id="errorMessage">
                <i class="fas fa-exclamation-triangle"></i>
                <span id="errorText"></span>
            </div>

            <div class="warning-message" id="warningMessage">
                <i class="fas fa-exclamation-circle"></i>
                <span id="warningText"></span>
            </div>

            <div class="fuel-grid" id="fuelGrid">
                <div class="fuel-card gasolina loading">
                    <div class="fuel-icon"><i class="fas fa-fire"></i></div>
                    <div class="fuel-name">Gasolina Comum</div>
                    <div class="fuel-price" id="priceGasolina">R$ --</div>
                    <div class="fuel-unit">por litro</div>
                </div>

                <div class="fuel-card etanol loading">
                    <div class="fuel-icon"><i class="fas fa-leaf"></i></div>
                    <div class="fuel-name">Etanol</div>
                    <div class="fuel-price" id="priceEtanol">R$ --</div>
                    <div class="fuel-unit">por litro</div>
                </div>
            </div>

            <div class="update-section">
                <button class="update-btn" id="updateBtn" onclick="fetchFuelPrices()">
                    <i class="fas fa-sync-alt"></i>
                    Atualizar Preços
                </button>
            </div>

            <div class="info-section">
                <div class="info-title">
                    <i class="fas fa-info-circle"></i>
                    Sobre os Dados
                </div>
                <div class="info-text">
                    Os preços exibidos são os <strong>preços médios de revenda</strong> praticados em Guarulhos,
                    obtidos da <a href="https://www.gov.br/anp/pt-br/assuntos/precos-e-defesa-da-concorrencia/precos/precos-revenda-e-de-distribuicao-combustiveis/serie-historica-do-levantamento-de-precos" target="_blank">
                    Série Histórica de Preços da ANP</a> (Agência Nacional do Petróleo, Gás Natural e Biocombustíveis).
                    <br><br>
                    <i class="far fa-calendar-alt"></i> Período dos dados: <span class="data-period" id="dataPeriod">Carregando...</span>
                    <br>
                    <a href="https://www.gov.br/anp/pt-br/assuntos/precos-e-defesa-da-concorrencia/precos/precos-revenda-e-de-distribuicao-combustiveis/serie-historica-do-levantamento-de-precos"
                       target="_blank" class="download-link" id="downloadExcelLink">
                        <i class="fas fa-download"></i>
                        Baixar Planilha da ANP
                    </a>
                </div>
            </div>

            <!-- Prime Report Section -->
            <div class="prime-section">
                <div class="info-title">
                    <i class="fas fa-file-pdf"></i>
                    Postos Credenciados - Prime Benefícios
                </div>
                <div class="info-text">
                    Relatório atualizado automaticamente toda <strong>segunda-feira às 07:00</strong> com a lista de postos credenciados em Guarulhos.
                </div>
                <a href="/prime-report.pdf" target="_blank" class="prime-btn" id="primeBtn">
                    <i class="fas fa-file-pdf"></i>
                    Ver Relatório de Postos (PDF)
                </a>
                <div class="prime-update-info" id="primeUpdateInfo">
                    <i class="far fa-clock"></i>
                    <span id="primeUpdateText">Atualizado toda segunda-feira</span>
                </div>
            </div>

            <!-- WhatsApp Section -->
            <div class="whatsapp-section">
                <div class="info-title">
                    <i class="fab fa-whatsapp"></i>
                    Compartilhar via WhatsApp
                </div>
                <div class="info-text">
                    Envie os preços atualizados para um grupo ou contato no WhatsApp. A mensagem será montada automaticamente com os valores da semana atual.
                </div>

                <button class="whatsapp-btn" id="whatsappBtn" onclick="openWhatsApp()" disabled>
                    <i class="fab fa-whatsapp"></i>
                    Enviar pelo WhatsApp
                </button>
            </div>
        </div>

        <!-- Kilometragem Tab -->
        <div class="tab-content" id="tab-kilometragem">
            <div class="km-container">
                <div class="km-header">
                    <div class="km-title">
                        <i class="fas fa-tachometer-alt"></i>
                        <h2>Controle de Kilometragem</h2>
                    </div>
                    <div class="km-actions">
                        <div class="km-update-info" id="kmUpdateInfo">
                            <i class="far fa-clock"></i>
                            <span id="kmUpdateText">Última atualização: --</span>
                        </div>
                        <button class="update-btn" id="kmUpdateBtn" onclick="refreshVehicles()">
                            <i class="fas fa-sync-alt"></i>
                            Atualizar Dados
                        </button>
                    </div>
                </div>

                <div class="km-table-container">
                    <div class="km-table-wrapper">
                        <table class="km-table">
                            <thead>
                                <tr>
                                    <th>Placa</th>
                                    <th>KM Atual</th>
                                    <th>Próx. Revisão</th>
                                    <th>10.000 km</th>
                                    <th>20.000 km</th>
                                    <th>30.000 km</th>
                                    <th>40.000 km</th>
                                    <th>50.000 km</th>
                                    <th>60.000 km</th>
                                </tr>
                            </thead>
                            <tbody id="kmTableBody">
                                <tr>
                                    <td colspan="9" class="km-empty-state">
                                        <i class="fas fa-car"></i>
                                        <p>Carregando veículos...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="km-legend">
                        <div class="km-legend-item">
                            <div class="km-legend-color urgent"></div>
                            <span>Menos de 1.000 km para revisão (sem data preenchida)</span>
                        </div>
                        <div class="km-legend-item">
                            <div class="km-legend-color warning"></div>
                            <span>Menos de 2.000 km para revisão</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            Dados fornecidos pela <a href="https://www.gov.br/anp" target="_blank">ANP</a> •
            Atualização automática diária às 07:00
        </footer>
    </div>

    <!-- Password Modal -->
    <div class="modal-overlay" id="passwordModal">
        <div class="modal-content">
            <div class="modal-title">
                <i class="fas fa-lock"></i>
                Acesso Restrito
            </div>
            <input type="password" class="modal-input" id="passwordInput" placeholder="Digite a senha" autocomplete="off">
            <div class="modal-error" id="passwordError">Senha incorreta. Tente novamente.</div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closePasswordModal()">Cancelar</button>
                <button class="modal-btn confirm" onclick="checkPassword()">Acessar</button>
            </div>
        </div>
    </div>


    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        const PRICES_URL = '/prices.json';
        const VEHICLES_URL = '/vehicles.json';
        const REVISIONS_KEY = 'vehicleRevisions';
        const KM_AUTH_KEY = 'kmAuthTimestamp';
        const KM_PASSWORD = 'transportescmg';
        const AUTH_DURATION = 24 * 60 * 60 * 1000; // 24 hours

        let isLoading = false;
        let lastCheckHour = -1;
        let currentPrices = { gasolinaComum: null, etanol: null };
        let vehiclesData = [];
        let revisions = {};

        // Tab switching
        function switchTab(tabName) {
            // Check if trying to access kilometragem tab
            if (tabName === 'kilometragem' && !isKmAuthenticated()) {
                showPasswordModal();
                return;
            }

            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.tab === tabName) {
                    btn.classList.add('active');
                }
            });

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById('tab-' + tabName).classList.add('active');

            // Load vehicles data when switching to kilometragem
            if (tabName === 'kilometragem') {
                loadVehicles();
            }
        }

        // Authentication
        function isKmAuthenticated() {
            const authTimestamp = getStoredValue(KM_AUTH_KEY);
            if (!authTimestamp) return false;
            const elapsed = Date.now() - parseInt(authTimestamp);
            return elapsed < AUTH_DURATION;
        }

        function setKmAuthenticated() {
            setStoredValue(KM_AUTH_KEY, Date.now().toString());
        }

        function showPasswordModal() {
            document.getElementById('passwordModal').classList.add('show');
            document.getElementById('passwordInput').value = '';
            document.getElementById('passwordError').classList.remove('show');
            document.getElementById('passwordInput').classList.remove('error');
            setTimeout(() => document.getElementById('passwordInput').focus(), 100);
        }

        function closePasswordModal() {
            document.getElementById('passwordModal').classList.remove('show');
        }

        function checkPassword() {
            const input = document.getElementById('passwordInput');
            const error = document.getElementById('passwordError');

            if (input.value === KM_PASSWORD) {
                setKmAuthenticated();
                closePasswordModal();
                switchTab('kilometragem');
            } else {
                input.classList.add('error');
                error.classList.add('show');
                setTimeout(() => input.classList.remove('error'), 500);
            }
        }

        // Handle Enter key on password input
        document.getElementById('passwordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkPassword();
            }
        });

        // Storage functions using cookies (localStorage not available in iframe)
        function getStoredValue(key) {
            const match = document.cookie.match(new RegExp('(^| )' + key + '=([^;]+)'));
            return match ? decodeURIComponent(match[2]) : null;
        }

        function setStoredValue(key, value) {
            const expires = new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toUTCString();
            document.cookie = key + '=' + encodeURIComponent(value) + '; expires=' + expires + '; path=/';
        }

        // Revisions storage
        function loadRevisions() {
            const stored = getStoredValue(REVISIONS_KEY);
            if (stored) {
                try {
                    revisions = JSON.parse(stored);
                } catch (e) {
                    revisions = {};
                }
            }
        }

        function saveRevisions() {
            setStoredValue(REVISIONS_KEY, JSON.stringify(revisions));
        }

        function setRevision(placa, milestone, date) {
            if (!revisions[placa]) {
                revisions[placa] = {};
            }
            if (date) {
                revisions[placa][milestone] = date;
            } else {
                delete revisions[placa][milestone];
            }
            saveRevisions();
            renderVehiclesTable();
        }

        // Calculate next revision milestone
        function getNextRevisionMilestone(km) {
            const milestones = [10000, 20000, 30000, 40000, 50000, 60000];
            for (const m of milestones) {
                if (km < m) {
                    return m;
                }
            }
            return null; // Beyond 60k
        }

        // Check if revision is filled
        function isRevisionFilled(placa, milestone) {
            return revisions[placa] && revisions[placa][milestone];
        }

        // Render vehicles table
        function renderVehiclesTable() {
            const tbody = document.getElementById('kmTableBody');

            if (vehiclesData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="km-empty-state">
                            <i class="fas fa-car"></i>
                            <p>Nenhum veículo encontrado. Execute a atualização ou aguarde a atualização automática.</p>
                        </td>
                    </tr>
                `;
                return;
            }

            // Calculate urgency for sorting
            const vehiclesWithUrgency = vehiclesData.map(v => {
                const nextMilestone = getNextRevisionMilestone(v.km);
                const kmToNext = nextMilestone ? nextMilestone - v.km : Infinity;
                const isFilled = nextMilestone ? isRevisionFilled(v.placa, nextMilestone) : true;
                const isUrgent = kmToNext < 1000 && !isFilled;
                const isWarning = kmToNext < 2000 && !isFilled;

                return {
                    ...v,
                    nextMilestone,
                    kmToNext,
                    isFilled,
                    isUrgent,
                    isWarning
                };
            });

            // Sort: urgent first, then by km remaining
            vehiclesWithUrgency.sort((a, b) => {
                if (a.isUrgent && !b.isUrgent) return -1;
                if (!a.isUrgent && b.isUrgent) return 1;
                if (a.isWarning && !b.isWarning) return -1;
                if (!a.isWarning && b.isWarning) return 1;
                return a.kmToNext - b.kmToNext;
            });

            const milestones = [10000, 20000, 30000, 40000, 50000, 60000];

            tbody.innerHTML = vehiclesWithUrgency.map(v => {
                const rowClass = v.isUrgent ? 'urgent' : '';

                let nextRevisionBadge = '';
                if (v.nextMilestone) {
                    const badgeClass = v.isUrgent ? 'urgent' : (v.isWarning ? 'warning' : 'ok');
                    const icon = v.isUrgent ? 'fa-exclamation-triangle' : (v.isWarning ? 'fa-exclamation-circle' : 'fa-check-circle');
                    nextRevisionBadge = `
                        <span class="km-next-revision ${badgeClass}">
                            <i class="fas ${icon}"></i>
                            ${v.kmToNext.toLocaleString('pt-BR')} km
                        </span>
                    `;
                } else {
                    nextRevisionBadge = '<span class="km-next-revision ok"><i class="fas fa-check-circle"></i> OK</span>';
                }

                const revisionCells = milestones.map(m => {
                    const revDate = revisions[v.placa] && revisions[v.placa][m] ? revisions[v.placa][m] : '';
                    const filledClass = revDate ? 'filled' : '';
                    return `
                        <td>
                            <input type="date"
                                   class="revision-input ${filledClass}"
                                   value="${revDate}"
                                   onchange="setRevision('${v.placa}', ${m}, this.value)"
                                   data-placa="${v.placa}"
                                   data-milestone="${m}">
                        </td>
                    `;
                }).join('');

                return `
                    <tr class="${rowClass}">
                        <td class="placa-cell">${v.placa}</td>
                        <td class="km-cell">${v.km.toLocaleString('pt-BR')}</td>
                        <td>${nextRevisionBadge}</td>
                        ${revisionCells}
                    </tr>
                `;
            }).join('');
        }

        // Load vehicles from JSON
        async function loadVehicles() {
            loadRevisions();

            try {
                const response = await fetch(VEHICLES_URL + '?t=' + Date.now());
                if (!response.ok) {
                    throw new Error('Erro ao carregar veículos');
                }

                const data = await response.json();

                if (data.success && data.vehicles) {
                    vehiclesData = data.vehicles;

                    // Update timestamp
                    if (data.updatedAt) {
                        const date = new Date(data.updatedAt);
                        document.getElementById('kmUpdateText').textContent =
                            'Última atualização: ' + date.toLocaleDateString('pt-BR', {
                                day: '2-digit',
                                month: '2-digit',
                                year: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                    }

                    renderVehiclesTable();
                } else {
                    throw new Error('Dados de veículos não disponíveis');
                }
            } catch (error) {
                console.error('Error loading vehicles:', error);
                document.getElementById('kmTableBody').innerHTML = `
                    <tr>
                        <td colspan="9" class="km-empty-state">
                            <i class="fas fa-exclamation-triangle"></i>
                            <p>Erro ao carregar dados. Tente atualizar ou aguarde a atualização automática.</p>
                        </td>
                    </tr>
                `;
            }
        }

        // Refresh vehicles button
        function refreshVehicles() {
            const btn = document.getElementById('kmUpdateBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Atualizando...';

            loadVehicles().finally(() => {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-sync-alt"></i> Atualizar Dados';
            });
        }

        // WhatsApp Functions
        function getWeekDates() {
            const now = new Date();
            const dayOfWeek = now.getDay();
            const monday = new Date(now);
            const diffToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
            monday.setDate(now.getDate() + diffToMonday);
            const friday = new Date(monday);
            friday.setDate(monday.getDate() + 4);
            return { monday, friday };
        }

        function formatDateBR(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        function openWhatsApp() {
            const gasolinaPrice = currentPrices.gasolinaComum;
            const etanolPrice = currentPrices.etanol;

            if (gasolinaPrice === null || etanolPrice === null) {
                showWhatsAppError('Os preços ainda não foram carregados.');
                return;
            }

            const weekDates = getWeekDates();
            const mondayStr = formatDateBR(weekDates.monday);
            const fridayStr = formatDateBR(weekDates.friday);
            const gasolinaFormatted = gasolinaPrice.toFixed(2).replace('.', ',');
            const etanolFormatted = etanolPrice.toFixed(2).replace('.', ',');

            const message = `Bom dia a todos!
Segue a lista dos Postos Credenciados para Abastecimento no período de ${mondayStr} a ${fridayStr}.
Além disso, informamos os valores máximos autorizados para abastecimento nesta semana:

Atenção: antes de abastecer, confirme o preço na bomba.

GASOLINA R$ ${gasolinaFormatted}
ÁLCOOL   R$ ${etanolFormatted}`;

            const encodedMessage = encodeURIComponent(message);
            window.open(`https://web.whatsapp.com/send?text=${encodedMessage}`, '_blank');
        }

        function showWhatsAppError(message) {
            const errorDiv = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            errorText.textContent = message;
            errorDiv.classList.add('show');
            setTimeout(() => errorDiv.classList.remove('show'), 5000);
        }


        function formatPrice(value) {
            if (value === null || value === undefined || isNaN(value)) return '--';
            return value.toFixed(2).replace('.', ',');
        }

        function formatDateTime(date) {
            return date.toLocaleDateString('pt-BR', {
                day: '2-digit', month: '2-digit', year: 'numeric',
                hour: '2-digit', minute: '2-digit'
            });
        }

        function formatDate(date) {
            return date.toLocaleDateString('pt-BR', {
                day: '2-digit', month: '2-digit', year: 'numeric'
            });
        }

        function setLoading(loading) {
            isLoading = loading;
            const btn = document.getElementById('updateBtn');
            const cards = document.querySelectorAll('.fuel-card');

            if (loading) {
                btn.disabled = true;
                btn.classList.add('loading');
                btn.innerHTML = '<i class="fas fa-spinner"></i> Baixando dados da ANP...';
                cards.forEach(card => card.classList.add('loading'));
            } else {
                btn.disabled = false;
                btn.classList.remove('loading');
                btn.innerHTML = '<i class="fas fa-sync-alt"></i> Atualizar Preços';
                cards.forEach(card => card.classList.remove('loading'));
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            document.getElementById('errorText').textContent = message;
            errorDiv.classList.add('show');
        }

        function hideError() {
            document.getElementById('errorMessage').classList.remove('show');
        }

        function formatDateFromISO(isoString) {
            const date = new Date(isoString);
            return date.toLocaleDateString('pt-BR', {
                day: '2-digit', month: '2-digit', year: 'numeric'
            });
        }

        function isDataOutdated(periodEnd) {
            // Os períodos da ANP vão de sábado a sexta-feira
            // Os dados estão atualizados se periodEnd for a sexta-feira mais recente
            const today = new Date();
            const dayOfWeek = today.getDay(); // 0 = domingo, 1 = segunda, ..., 5 = sexta, 6 = sábado

            // Calcular a última sexta-feira
            // Dom(0)->2 dias atrás, Seg(1)->3, Ter(2)->4, Qua(3)->5, Qui(4)->6, Sex(5)->0 (hoje), Sáb(6)->1
            let daysToLastFriday;
            if (dayOfWeek === 5) {
                // Hoje é sexta, a última sexta é hoje
                daysToLastFriday = 0;
            } else if (dayOfWeek === 6) {
                // Hoje é sábado, a última sexta foi ontem
                daysToLastFriday = 1;
            } else {
                // Domingo a quinta: voltar para a sexta passada
                // Dom(0)->2, Seg(1)->3, Ter(2)->4, Qua(3)->5, Qui(4)->6
                daysToLastFriday = dayOfWeek + 2;
            }

            const lastFriday = new Date(today);
            lastFriday.setDate(today.getDate() - daysToLastFriday);
            lastFriday.setHours(0, 0, 0, 0);

            // Data final dos dados
            const endDate = new Date(periodEnd);
            endDate.setHours(0, 0, 0, 0);

            // Se a data final é anterior à última sexta-feira, os dados estão desatualizados
            return endDate < lastFriday;
        }

        function showWarning(message) {
            const warningElement = document.getElementById('warningMessage');
            const warningText = document.getElementById('warningText');
            warningText.innerHTML = message;
            warningElement.classList.add('show');
        }

        function hideWarning() {
            document.getElementById('warningMessage').classList.remove('show');
        }

        function updateUI(data, periodStart, periodEnd, sourceUrl) {
            currentPrices.gasolinaComum = data.gasolinaComum;
            currentPrices.etanol = data.etanol;

            document.getElementById('priceGasolina').innerHTML =
                `<span class="currency">R$</span> ${formatPrice(data.gasolinaComum)}`;
            document.getElementById('priceEtanol').innerHTML =
                `<span class="currency">R$</span> ${formatPrice(data.etanol)}`;

            document.getElementById('lastUpdateTime').textContent = formatDateTime(new Date());

            // Update reference week (from ANP data)
            const startFormatted = formatDateFromISO(periodStart);
            const endFormatted = formatDateFromISO(periodEnd);
            const weekText = `${startFormatted} a ${endFormatted}`;
            document.getElementById('referenceWeekText').textContent = weekText;
            document.getElementById('referenceWeek').style.display = 'flex';

            const dataPeriodElement = document.getElementById('dataPeriod');
            dataPeriodElement.textContent = weekText;

            // Verificar se os dados estão desatualizados
            const outdated = isDataOutdated(periodEnd);

            if (outdated) {
                // Adicionar classe de desatualizado ao período
                dataPeriodElement.classList.add('outdated');

                // Mostrar mensagem de aviso
                const warningMsg = `<strong>⚠️ Dados desatualizados:</strong> Os valores ainda não foram atualizados pela ANP e são referentes à semana de ${startFormatted} a ${endFormatted}. Atualize novamente em alguns minutos ou verifique o site da ANP.`;
                showWarning(warningMsg);
            } else {
                dataPeriodElement.classList.remove('outdated');
                hideWarning();
            }

            // Update Excel download link if sourceUrl is available
            if (sourceUrl) {
                const downloadLink = document.getElementById('downloadExcelLink');
                if (downloadLink) {
                    downloadLink.href = sourceUrl;
                }
            }

            // Atualizar status do flag baseado nos dados
            const liveStatus = document.getElementById('liveStatus');
            const liveStatusText = document.getElementById('liveStatusText');

            // Remover classes anteriores
            liveStatus.classList.remove('live', 'outdated', 'error');

            if (outdated) {
                // Dados do site da ANP desatualizados (amarelo)
                liveStatus.classList.add('outdated');
                liveStatusText.textContent = 'Site da ANP desatualizado';
            } else {
                // Dados atualizados (verde)
                liveStatus.classList.add('live');
                liveStatusText.textContent = 'Dados atualizados';
            }

            liveStatus.style.display = 'flex';
            hideError();
            document.getElementById('whatsappBtn').disabled = false;
        }

        function setStatusError() {
            const liveStatus = document.getElementById('liveStatus');
            const liveStatusText = document.getElementById('liveStatusText');

            liveStatus.classList.remove('live', 'outdated', 'error');
            liveStatus.classList.add('error');
            liveStatusText.textContent = 'Erro ao carregar dados';
            liveStatus.style.display = 'flex';
        }

        async function fetchFuelPrices() {
            if (isLoading) return;

            setLoading(true);
            hideError();

            try {
                // Add cache-busting parameter to ensure fresh data
                const url = `${PRICES_URL}?t=${Date.now()}`;
                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error('Erro ao buscar dados: ' + response.status);
                }

                const result = await response.json();

                if (!result.success || !result.data.gasolinaComum) {
                    throw new Error('Dados ainda não disponíveis. Aguarde a atualização automática.');
                }

                updateUI(result.data, result.periodStart, result.periodEnd, result.sourceUrl);
            } catch (error) {
                console.error('Error fetching fuel prices:', error);
                showError('Erro ao buscar dados: ' + error.message);
                setStatusError();
            } finally {
                setLoading(false);
            }
        }

        function checkAutoUpdate() {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();

            if (currentHour === 7 && currentMinute === 0 && lastCheckHour !== 7) {
                lastCheckHour = 7;
                fetchFuelPrices();
            } else if (currentHour !== 7) {
                lastCheckHour = -1;
            }

            const nextUpdate = new Date();
            if (currentHour >= 7) nextUpdate.setDate(nextUpdate.getDate() + 1);
            nextUpdate.setHours(7, 0, 0, 0);

            const hoursUntil = Math.floor((nextUpdate - now) / (1000 * 60 * 60));
            const minutesUntil = Math.floor(((nextUpdate - now) % (1000 * 60 * 60)) / (1000 * 60));

            document.getElementById('nextUpdateTime').textContent = hoursUntil > 0
                ? `${hoursUntil}h ${minutesUntil}min`
                : `${minutesUntil}min`;
        }

        setInterval(checkAutoUpdate, 60000);
        checkAutoUpdate();

        // Initial load
        fetchFuelPrices();
    </script>
</body>
</html>
